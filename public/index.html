
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="css/table.css">
    <link rel="stylesheet" href="css/default.css">
    <link rel="shortcut icon" href="https://www.sptech.school/assets/images/favicons/favicon_01.png"/>
    <title>SPTech Challenge</title>
</head>
<body>
    <div class="head">
        <h1>SPTech Challenge</h1>
        <span>Jogue com os seus professores preferidos!</span>
    </div>

    <div class="windowScreen">
        <div class="windowScreenA">
            <div class="titleRanking">
                <span>Ranking</span>
            </div>

            <div class="rankingDiv">
                <table class="rankingTable">
                    <tr>
                        <th>Posição</th>
                        <th>Aluno</th>
                        <th>Pontos</th>
                        <th>Acertos</th>
                    </tr>
                    <tr>
                        <td>1º</td>
                        <td>Maria Anders</td>
                        <td>1.548</td>
                        <td>24/25</td>
                    </tr>
                    <tr>
                        <td>2º</td>
                        <td>Christina Berglund</td>
                        <td>1.500</td>
                        <td>23/25</td>
                    </tr>
                    <tr>
                        <td>3º</td>
                        <td>Francisco Chang</td>
                        <td>1.470</td>
                        <td>21/25</td>
                    </tr>
                    <tr>
                        <td>4º</td>
                        <td>Francisco Chang</td>
                        <td>1.210</td>
                        <td>18/25</td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="windowScreenB">
            <div class="boxCadLog">
                <div class="boxHeader">
                    <div class="headerLogin" onclick="changeLogin()">
                        <span>Login</span>
                    </div>
                    <div class="headerCadastro" onclick="changeCadastro()">
                        <span>Cadastro</span>
                    </div>
                </div>
                <div class="formBody">
                    <div id="loginForm">
                        <div class="boxInput">
                            <p><span>RA</span></p>
                            <input type="text" id="raInp">
                        </div>
                        <div class="boxInput">
                            <p><span>Senha</span></p>
                            <input type="password" id="senhaInp">
                        </div>
                        <div class="boxInput">
                            <button onclick="loginIndex()">Entrar</button>
                        </div>
                    </div>
                    
                    <div id="cadastroBox" style="display: none">
                        <div class="boxInput">
                            <p><span>Nome Completo</span></p>
                            <input type="text" id="nomeInp">
                        </div>
                        <div class="boxInput">
                            <p><span>RA</span></p>
                            <input type="text" id="raInp">
                        </div>
                        <div class="boxInput">
                            <p><span>E-mail</span></p>
                            <input type="text" id="emailInp">
                        </div>
                        <div class="boxInput">
                            <p><span>Senha</span></p>
                            <input type="password" id="senhaInp">
                        </div>
                        <div class="boxInput">
                            <p><span>Curso</span></p>
                            <select id="cursoInp">
                                <option value="0">Selecione...</option>
                                <option value="1">Análise e Desenvolvimento de Sistemas</option>
                                <option value="2">Ciência da Computação</option>
                                <option value="3">Sistemas de Informação</option>
                            </select>
                        </div>
                        <div class="boxInput">
                            <p><span>Semestre</span></p>
                            <select id="semestreInp">
                                <option value="0">Selecione...</option>
                                <option value="1">1º Semestre</option>
                                <option value="2">2º Semestre</option>
                                <option value="3">3º Semestre</option>
                                <option value="4">4º Semestre</option>
                                <option value="5">5º Semestre</option>
                                <option value="6">6º Semestre</option>
                                <option value="7">7º Semestre</option>
                                <option value="8">8º Semestre</option>
                            </select>
                        </div>
                        <div class="boxInput">
                            <button onclick="cadastrarIndex()">Cadastrar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>Desenvolvido com carinho por</p>
        <p><a href="www.github.com/leovasc5" style="text-decoration:none; color:#63B1BD">Leonardo Vasconcelos Paulino</a></p>
    </div>
</body>
</html>

<script>
    function changeCadastro(){
        loginForm.style.display = 'none';
        cadastroBox.style.display = 'block';

        hLog = document.querySelector('.headerLogin');
        hLog.style.backgroundColor = '#7e8390';
        hLog.style.color = '#fff';
        hLog.style.cursor = 'pointer';

        hCad = document.querySelector('.headerCadastro');
        hCad.style.backgroundColor = 'aqua';
        hCad.style.color = '#1F2B45';
        hCad.style.cursor = 'default';

        janelaB = document.querySelector('.windowScreenB');
        janelaB.style.height = '564px';

    }

    function changeLogin(){
        loginForm.style.display = 'block';
        cadastroBox.style.display = 'none';

        hLog = document.querySelector('.headerLogin');
        hLog.style.backgroundColor = 'aqua';
        hLog.style.color = '#1F2B45';
        hLog.style.cursor = 'default';

        hCad = document.querySelector('.headerCadastro');
        hCad.style.backgroundColor = '#7e8390';
        hCad.style.color = '#fff';
        hCad.style.cursor = 'pointer';

        janelaB = document.querySelector('.windowScreenB');
        janelaB.style.height = 'auto';
    }

    function loginIndex(){
        var ra = raInp.value;
        var senha = senhaInp.value;

        if (ra == "" || senha == "") {
            // Disparar erro
            return false;
        }

        fetch("/usuarios/autenticar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                raServer: ra,
                senhaServer: senha
            })
        }).then(function (resposta) {        
            if (resposta.ok) {
                console.log(resposta);
            
                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));
                
                    sessionStorage.EMAIL_USUARIO = json.email;
                    sessionStorage.NOME_USUARIO = json.nome;
                    sessionStorage.ID_USUARIO = json.id;
                
                    setTimeout(function () {
                        window.location = "./dashboard/cards.html";
                    }, 1000); // apenas para exibir o loading
                
                });
            
            } else {
            
                console.log("Houve um erro ao tentar realizar o login!");
            
                resposta.text().then(texto => {
                    console.error(texto);
                    finalizarAguardar(texto);
                });
            }
        
        }).catch(function (erro) {
            console.log(erro);
        })

        return false;
    }

    function cadastrarIndex(){
        var nome = nomeInp.value;
        var ra = raInp.value
        var email = emailInp.value;
        var senha = senhaInp.value;
        var curso = cursoInp.value;
        var semestre = semestreInp;

        if (nome == "" || ra == "" || email == "" || senha == "" || curso == "" || semestre) {
            // Mensagem de erro
            return false;
        }

        fetch("/usuarios/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // CONTINUAR DAQUI
                nomeServer: nomeVar,
                emailServer: emailVar,
                senhaServer: senhaVar
            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                cardErro.style.display = "block";

                mensagem_erro.innerHTML = "Cadastro realizado com sucesso! Redirecionando para tela de Login...";

                setTimeout(() => {
                    window.location = "login.html";
                }, "2000")
                
                limparFormulario();
                finalizarAguardar();
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
            finalizarAguardar();
        });

        return false;
    }
</script>

<script src="./js/funcoes.js"></script>

<!-- Criado por: LEONARDO VASCONCELOS PAULINO
GitHub: https://github.com/leovasc5/
Instagram: https://www.instagram.com/leovasc5
-->